# OpenOCD configuration for STM32F030C8
# Interface configuration - using ST-Link v2
source [find interface/stlink.cfg]

# Target configuration
source [find target/stm32f0x.cfg]

# Transport selection
transport select hla_swd

# Adapter speed
adapter speed 4000

# Reset configuration
reset_config srst_only

# Custom commands for production programming
proc check_target_voltage {} {
    # Initialize and check if target is responsive
    init
    targets
    return 1
}

proc flash_gamekit_firmware {hex_file} {
    init
    reset halt
    flash write_image erase $hex_file
    reset run
}

proc check_connection {} {
    # Check if STM32F030 is connected and responsive
    if {[catch {init}]} {
        return 0
    }
    if {[catch {targets}]} {
        return 0
    }
    return 1
}